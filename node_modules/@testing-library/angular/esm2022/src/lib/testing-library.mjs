import { ApplicationInitStatus, ChangeDetectorRef, Component, isStandalone, NgZone, SimpleChange, } from '@angular/core';
import { DeferBlockBehavior, TestBed, tick } from '@angular/core/testing';
import { BrowserAnimationsModule, NoopAnimationsModule } from '@angular/platform-browser/animations';
import { Router } from '@angular/router';
import { RouterTestingModule } from '@angular/router/testing';
import { configure as dtlConfigure, getQueriesForElement as dtlGetQueriesForElement, prettyDOM as dtlPrettyDOM, screen as dtlScreen, waitFor as dtlWaitFor, waitForElementToBeRemoved as dtlWaitForElementToBeRemoved, within as dtlWithin, } from '@testing-library/dom';
import { getConfig } from './config';
import * as i0 from "@angular/core";
const mountedFixtures = new Set();
const safeInject = TestBed.inject || TestBed.get;
export async function render(sut, renderOptions = {}) {
    const { dom: domConfig, ...globalConfig } = getConfig();
    const { detectChangesOnRender = true, autoDetectChanges = true, declarations = [], imports = [], providers = [], schemas = [], queries, wrapper = WrapperComponent, componentProperties = {}, componentInputs = {}, componentOutputs = {}, componentProviders = [], childComponentOverrides = [], componentImports: componentImports, excludeComponentDeclaration = false, routes = [], removeAngularAttributes = false, defaultImports = [], initialRoute = '', deferBlockStates = undefined, deferBlockBehavior = undefined, configureTestBed = () => {
        /* noop*/
    }, } = { ...globalConfig, ...renderOptions };
    dtlConfigure({
        eventWrapper: (cb) => {
            const result = cb();
            if (autoDetectChanges) {
                detectChangesForMountedFixtures();
            }
            return result;
        },
        ...domConfig,
    });
    TestBed.configureTestingModule({
        declarations: addAutoDeclarations(sut, {
            declarations,
            excludeComponentDeclaration,
            wrapper,
        }),
        imports: addAutoImports(sut, {
            imports: imports.concat(defaultImports),
            routes,
        }),
        providers: [...providers],
        schemas: [...schemas],
        deferBlockBehavior: deferBlockBehavior ?? DeferBlockBehavior.Manual,
    });
    overrideComponentImports(sut, componentImports);
    overrideChildComponentProviders(childComponentOverrides);
    configureTestBed(TestBed);
    await TestBed.compileComponents();
    componentProviders
        .reduce((acc, provider) => acc.concat(provider), [])
        .forEach((p) => {
        const { provide, ...provider } = p;
        TestBed.overrideProvider(provide, provider);
    });
    const componentContainer = createComponentFixture(sut, wrapper);
    const zone = safeInject(NgZone);
    const router = safeInject(Router);
    const _navigate = async (elementOrPath, basePath = '') => {
        const href = typeof elementOrPath === 'string' ? elementOrPath : elementOrPath.getAttribute('href');
        const [path, params] = (basePath + href).split('?');
        const queryParams = params
            ? params.split('&').reduce((qp, q) => {
                const [key, value] = q.split('=');
                const currentValue = qp[key];
                if (typeof currentValue === 'undefined') {
                    qp[key] = value;
                }
                else if (Array.isArray(currentValue)) {
                    qp[key] = [...currentValue, value];
                }
                else {
                    qp[key] = [currentValue, value];
                }
                return qp;
            }, {})
            : undefined;
        const navigateOptions = queryParams
            ? {
                queryParams,
            }
            : undefined;
        const doNavigate = () => {
            return navigateOptions ? router?.navigate([path], navigateOptions) : router?.navigate([path]);
        };
        let result;
        if (zone) {
            await zone.run(() => (result = doNavigate()));
        }
        else {
            result = doNavigate();
        }
        return result ?? false;
    };
    if (initialRoute)
        await _navigate(initialRoute);
    if (typeof router?.initialNavigation === 'function') {
        if (zone) {
            zone.run(() => router.initialNavigation());
        }
        else {
            router.initialNavigation();
        }
    }
    let detectChanges;
    const fixture = await renderFixture(componentProperties, componentInputs, componentOutputs);
    if (deferBlockStates) {
        if (Array.isArray(deferBlockStates)) {
            for (const deferBlockState of deferBlockStates) {
                await renderDeferBlock(fixture, deferBlockState.deferBlockState, deferBlockState.deferBlockIndex);
            }
        }
        else {
            await renderDeferBlock(fixture, deferBlockStates);
        }
    }
    let renderedPropKeys = Object.keys(componentProperties);
    let renderedInputKeys = Object.keys(componentInputs);
    let renderedOutputKeys = Object.keys(componentOutputs);
    const rerender = async (properties) => {
        const newComponentInputs = properties?.componentInputs ?? {};
        const changesInComponentInput = update(fixture, renderedInputKeys, newComponentInputs, setComponentInputs, properties?.partialUpdate ?? false);
        renderedInputKeys = Object.keys(newComponentInputs);
        const newComponentOutputs = properties?.componentOutputs ?? {};
        for (const outputKey of renderedOutputKeys) {
            if (!Object.prototype.hasOwnProperty.call(newComponentOutputs, outputKey)) {
                delete fixture.componentInstance[outputKey];
            }
        }
        setComponentOutputs(fixture, newComponentOutputs);
        renderedOutputKeys = Object.keys(newComponentOutputs);
        const newComponentProps = properties?.componentProperties ?? {};
        const changesInComponentProps = update(fixture, renderedPropKeys, newComponentProps, setComponentProperties, properties?.partialUpdate ?? false);
        renderedPropKeys = Object.keys(newComponentProps);
        if (hasOnChangesHook(fixture.componentInstance)) {
            fixture.componentInstance.ngOnChanges({
                ...changesInComponentInput,
                ...changesInComponentProps,
            });
        }
        if (properties?.detectChangesOnRender !== false) {
            fixture.componentRef.injector.get(ChangeDetectorRef).detectChanges();
        }
    };
    const navigate = async (elementOrPath, basePath = '') => {
        const result = await _navigate(elementOrPath, basePath);
        detectChanges();
        return result;
    };
    return {
        fixture,
        detectChanges: () => detectChanges(),
        navigate,
        rerender,
        renderDeferBlock: async (deferBlockState, deferBlockIndex) => {
            await renderDeferBlock(fixture, deferBlockState, deferBlockIndex);
        },
        debugElement: fixture.debugElement,
        container: fixture.nativeElement,
        debug: (element = fixture.nativeElement, maxLength, options) => Array.isArray(element)
            ? element.forEach((e) => console.log(dtlPrettyDOM(e, maxLength, options)))
            : console.log(dtlPrettyDOM(element, maxLength, options)),
        ...replaceFindWithFindAndDetectChanges(dtlGetQueriesForElement(fixture.nativeElement, queries)),
    };
    async function renderFixture(properties, inputs, outputs) {
        const createdFixture = await createComponent(componentContainer);
        setComponentProperties(createdFixture, properties);
        setComponentInputs(createdFixture, inputs);
        setComponentOutputs(createdFixture, outputs);
        if (removeAngularAttributes) {
            createdFixture.nativeElement.removeAttribute('ng-version');
            const idAttribute = createdFixture.nativeElement.getAttribute('id');
            if (idAttribute && idAttribute.startsWith('root')) {
                createdFixture.nativeElement.removeAttribute('id');
            }
        }
        mountedFixtures.add(createdFixture);
        let isAlive = true;
        createdFixture.componentRef.onDestroy(() => (isAlive = false));
        if (hasOnChangesHook(createdFixture.componentInstance) && Object.keys(properties).length > 0) {
            const changes = getChangesObj(null, componentProperties);
            createdFixture.componentInstance.ngOnChanges(changes);
        }
        detectChanges = () => {
            if (isAlive) {
                createdFixture.detectChanges();
            }
        };
        if (detectChangesOnRender) {
            detectChanges();
        }
        return createdFixture;
    }
}
async function createComponent(component) {
    /* Make sure angular application is initialized before creating component */
    await safeInject(ApplicationInitStatus).donePromise;
    return TestBed.createComponent(component);
}
function createComponentFixture(sut, wrapper) {
    if (typeof sut === 'string') {
        TestBed.overrideTemplate(wrapper, sut);
        return wrapper;
    }
    return sut;
}
function setComponentProperties(fixture, componentProperties = {}) {
    for (const key of Object.keys(componentProperties)) {
        const descriptor = Object.getOwnPropertyDescriptor(fixture.componentInstance.constructor.prototype, key);
        let _value = componentProperties[key];
        const defaultGetter = () => _value;
        const extendedSetter = (value) => {
            _value = value;
            descriptor?.set?.call(fixture.componentInstance, _value);
            fixture.detectChanges();
        };
        Object.defineProperty(fixture.componentInstance, key, {
            get: descriptor?.get || defaultGetter,
            set: extendedSetter,
            // Allow the property to be defined again later.
            // This happens when the component properties are updated after initial render.
            // For Jest this is `true` by default, for Karma and a real browser the default is `false`
            configurable: true,
        });
        descriptor?.set?.call(fixture.componentInstance, _value);
    }
    return fixture;
}
function setComponentOutputs(fixture, componentOutputs = {}) {
    for (const [name, value] of Object.entries(componentOutputs)) {
        fixture.componentInstance[name] = value;
    }
}
function setComponentInputs(fixture, componentInputs = {}) {
    for (const [name, value] of Object.entries(componentInputs)) {
        fixture.componentRef.setInput(name, value);
    }
}
function overrideComponentImports(sut, imports) {
    if (imports) {
        if (typeof sut === 'function' && isStandalone(sut)) {
            TestBed.overrideComponent(sut, { set: { imports } });
        }
        else {
            throw new Error(`Error while rendering ${sut}: Cannot specify componentImports on a template or non-standalone component.`);
        }
    }
}
function overrideChildComponentProviders(componentOverrides) {
    componentOverrides?.forEach(({ component, providers }) => {
        TestBed.overrideComponent(component, { set: { providers } });
    });
}
function hasOnChangesHook(componentInstance) {
    return (componentInstance !== null &&
        typeof componentInstance === 'object' &&
        'ngOnChanges' in componentInstance &&
        typeof componentInstance.ngOnChanges === 'function');
}
function getChangesObj(oldProps, newProps) {
    const isFirstChange = oldProps === null;
    return Object.keys(newProps).reduce((changes, key) => ({
        ...changes,
        [key]: new SimpleChange(isFirstChange ? null : oldProps[key], newProps[key], isFirstChange),
    }), {});
}
function update(fixture, prevRenderedKeys, newValues, updateFunction, partialUpdate) {
    const componentInstance = fixture.componentInstance;
    const simpleChanges = {};
    for (const key of prevRenderedKeys) {
        if (!partialUpdate && !Object.prototype.hasOwnProperty.call(newValues, key)) {
            simpleChanges[key] = new SimpleChange(componentInstance[key], undefined, false);
            delete componentInstance[key];
        }
    }
    for (const [key, value] of Object.entries(newValues)) {
        if (value !== componentInstance[key]) {
            simpleChanges[key] = new SimpleChange(componentInstance[key], value, false);
        }
    }
    updateFunction(fixture, newValues);
    return simpleChanges;
}
function addAutoDeclarations(sut, { declarations = [], excludeComponentDeclaration, wrapper, }) {
    if (typeof sut === 'string') {
        return [...declarations, wrapper];
    }
    const components = () => (excludeComponentDeclaration || isStandalone(sut) ? [] : [sut]);
    return [...declarations, ...components()];
}
function addAutoImports(sut, { imports = [], routes }) {
    const animations = () => {
        const animationIsDefined = imports.indexOf(NoopAnimationsModule) > -1 || imports.indexOf(BrowserAnimationsModule) > -1;
        return animationIsDefined ? [] : [NoopAnimationsModule];
    };
    const routing = () => (routes ? [RouterTestingModule.withRoutes(routes)] : []);
    const components = () => (typeof sut !== 'string' && isStandalone(sut) ? [sut] : []);
    return [...imports, ...components(), ...animations(), ...routing()];
}
async function renderDeferBlock(fixture, deferBlockState, deferBlockIndex) {
    const deferBlockFixtures = await fixture.getDeferBlocks();
    if (deferBlockIndex !== undefined) {
        if (deferBlockIndex < 0) {
            throw new Error('deferBlockIndex must be a positive number');
        }
        const deferBlockFixture = deferBlockFixtures[deferBlockIndex];
        if (!deferBlockFixture) {
            throw new Error(`Could not find a deferrable block with index '${deferBlockIndex}'`);
        }
        await deferBlockFixture.render(deferBlockState);
    }
    else {
        for (const deferBlockFixture of deferBlockFixtures) {
            await deferBlockFixture.render(deferBlockState);
        }
    }
}
/**
 * Wrap waitFor to invoke the Angular change detection cycle before invoking the callback
 */
async function waitForWrapper(detectChanges, callback, options) {
    let inFakeAsync = true;
    try {
        tick(0);
    }
    catch (err) {
        inFakeAsync = false;
    }
    return await dtlWaitFor(() => {
        setTimeout(() => detectChanges(), 0);
        if (inFakeAsync) {
            tick(0);
        }
        return callback();
    }, options);
}
/**
 * Wrap waitForElementToBeRemovedWrapper to poke the Angular change detection cycle before invoking the callback
 */
async function waitForElementToBeRemovedWrapper(detectChanges, callback, options) {
    let cb;
    if (typeof callback !== 'function') {
        const elements = (Array.isArray(callback) ? callback : [callback]);
        const getRemainingElements = elements.map((element) => {
            let parent = element.parentElement;
            while (parent.parentElement) {
                parent = parent.parentElement;
            }
            return () => (parent.contains(element) ? element : null);
        });
        cb = () => getRemainingElements.map((c) => c()).find(Boolean);
    }
    else {
        cb = callback;
    }
    return await dtlWaitForElementToBeRemoved(() => {
        const result = cb();
        detectChanges();
        return result;
    }, options);
}
function cleanup() {
    mountedFixtures.forEach(cleanupAtFixture);
}
function cleanupAtFixture(fixture) {
    fixture.destroy();
    if (!fixture.nativeElement.getAttribute('ng-version') && fixture.nativeElement.parentNode === document.body) {
        document.body.removeChild(fixture.nativeElement);
    }
    else if (!fixture.nativeElement.getAttribute('id') && document.body.children?.[0] === fixture.nativeElement) {
        document.body.removeChild(fixture.nativeElement);
    }
    mountedFixtures.delete(fixture);
}
// if we're running in a test runner that supports afterEach
// then we'll automatically run cleanup afterEach test
// this ensures that tests run in isolation from each other
// if you don't like this, set the ATL_SKIP_AUTO_CLEANUP env variable to 'true'
if (typeof process === 'undefined' || !process.env?.ATL_SKIP_AUTO_CLEANUP) {
    if (typeof afterEach === 'function') {
        afterEach(() => {
            cleanup();
        });
    }
}
class WrapperComponent {
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.2", ngImport: i0, type: WrapperComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.3.2", type: WrapperComponent, selector: "atl-wrapper-component", ngImport: i0, template: '', isInline: true }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.2", ngImport: i0, type: WrapperComponent, decorators: [{
            type: Component,
            args: [{ selector: 'atl-wrapper-component', template: '' }]
        }] });
/**
 * Wrap findBy queries to poke the Angular change detection cycle
 */
function replaceFindWithFindAndDetectChanges(originalQueriesForContainer) {
    return Object.keys(originalQueriesForContainer).reduce((newQueries, key) => {
        const getByQuery = originalQueriesForContainer[key.replace('find', 'get')];
        if (key.startsWith('find') && getByQuery) {
            newQueries[key] = async (...queryOptions) => {
                const waitOptions = queryOptions.length === 3 ? queryOptions.pop() : undefined;
                // original implementation at https://github.com/testing-library/dom-testing-library/blob/main/src/query-helpers.js
                return await waitForWrapper(detectChangesForMountedFixtures, () => getByQuery(...queryOptions), waitOptions);
            };
        }
        else {
            newQueries[key] = originalQueriesForContainer[key];
        }
        return newQueries;
    }, {});
}
/**
 * Call detectChanges for all fixtures
 */
function detectChangesForMountedFixtures() {
    mountedFixtures.forEach((fixture) => {
        try {
            fixture.detectChanges();
        }
        catch (err) {
            if (!err.message.startsWith('ViewDestroyedError')) {
                throw err;
            }
        }
    });
}
/**
 * Re-export screen with patched queries
 */
const screen = replaceFindWithFindAndDetectChanges(dtlScreen);
/**
 * Re-export within with patched queries
 */
const within = (element, queriesToBind) => {
    const container = dtlWithin(element, queriesToBind);
    return replaceFindWithFindAndDetectChanges(container);
};
/**
 * Re-export waitFor with patched waitFor
 */
async function waitFor(callback, options) {
    return waitForWrapper(detectChangesForMountedFixtures, callback, options);
}
/**
 * Re-export waitForElementToBeRemoved with patched waitForElementToBeRemoved
 */
async function waitForElementToBeRemoved(callback, options) {
    return waitForElementToBeRemovedWrapper(detectChangesForMountedFixtures, callback, options);
}
/**
 * Manually export otherwise we get the following error while running Jest tests
 * TypeError: Cannot set property fireEvent of [object Object] which has only a getter
 * exports.fireEvent = fireEvent
 */
export { fireEvent, buildQueries, getByLabelText, getAllByLabelText, queryByLabelText, queryAllByLabelText, findByLabelText, findAllByLabelText, getByPlaceholderText, getAllByPlaceholderText, queryByPlaceholderText, queryAllByPlaceholderText, findByPlaceholderText, findAllByPlaceholderText, getByText, getAllByText, queryByText, queryAllByText, findByText, findAllByText, getByAltText, getAllByAltText, queryByAltText, queryAllByAltText, findByAltText, findAllByAltText, getByTitle, getAllByTitle, queryByTitle, queryAllByTitle, findByTitle, findAllByTitle, getByDisplayValue, getAllByDisplayValue, queryByDisplayValue, queryAllByDisplayValue, findByDisplayValue, findAllByDisplayValue, getByRole, getAllByRole, queryByRole, queryAllByRole, findByRole, findAllByRole, getByTestId, getAllByTestId, queryByTestId, queryAllByTestId, findByTestId, findAllByTestId, createEvent, getDefaultNormalizer, getElementError, getNodeText, getQueriesForElement, getRoles, isInaccessible, logDOM, logRoles, prettyDOM, queries, queryAllByAttribute, queryByAttribute, queryHelpers, } from '@testing-library/dom';
// export patched dtl
export { screen, waitFor, waitForElementToBeRemoved, within };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdGluZy1saWJyYXJ5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdGVzdGluZy1saWJyYXJ5L3NyYy9saWIvdGVzdGluZy1saWJyYXJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxxQkFBcUIsRUFDckIsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxZQUFZLEVBQ1osTUFBTSxFQUVOLFlBQVksR0FHYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQW9CLGtCQUFrQixFQUFtQixPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0csT0FBTyxFQUFFLHVCQUF1QixFQUFFLG9CQUFvQixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDckcsT0FBTyxFQUFvQixNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUU5RCxPQUFPLEVBQ0wsU0FBUyxJQUFJLFlBQVksRUFDekIsb0JBQW9CLElBQUksdUJBQXVCLEVBQy9DLFNBQVMsSUFBSSxZQUFZLEVBRXpCLE1BQU0sSUFBSSxTQUFTLEVBQ25CLE9BQU8sSUFBSSxVQUFVLEVBQ3JCLHlCQUF5QixJQUFJLDRCQUE0QixFQUV6RCxNQUFNLElBQUksU0FBUyxHQUNwQixNQUFNLHNCQUFzQixDQUFDO0FBRTlCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxVQUFVLENBQUM7O0FBRXJDLE1BQU0sZUFBZSxHQUFHLElBQUksR0FBRyxFQUF5QixDQUFDO0FBQ3pELE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQztBQVdqRCxNQUFNLENBQUMsS0FBSyxVQUFVLE1BQU0sQ0FDMUIsR0FBMkIsRUFDM0IsZ0JBQXNGLEVBQUU7SUFFeEYsTUFBTSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVB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QixnQkFBZ0IsRUFDaEIsWUFBWSxHQUNiLE1BQU0sc0JBQXNCLENBQUM7QUFFOUIscUJBQXFCO0FBQ3JCLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQXBwbGljYXRpb25Jbml0U3RhdHVzLFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBpc1N0YW5kYWxvbmUsXG4gIE5nWm9uZSxcbiAgT25DaGFuZ2VzLFxuICBTaW1wbGVDaGFuZ2UsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFR5cGUsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29tcG9uZW50Rml4dHVyZSwgRGVmZXJCbG9ja0JlaGF2aW9yLCBEZWZlckJsb2NrU3RhdGUsIFRlc3RCZWQsIHRpY2sgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQnJvd3NlckFuaW1hdGlvbnNNb2R1bGUsIE5vb3BBbmltYXRpb25zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlci9hbmltYXRpb25zJztcbmltcG9ydCB7IE5hdmlnYXRpb25FeHRyYXMsIFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBSb3V0ZXJUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyL3Rlc3RpbmcnO1xuaW1wb3J0IHR5cGUgeyBCb3VuZEZ1bmN0aW9ucywgUXVlcmllcyB9IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvZG9tJztcbmltcG9ydCB7XG4gIGNvbmZpZ3VyZSBhcyBkdGxDb25maWd1cmUsXG4gIGdldFF1ZXJpZXNGb3JFbGVtZW50IGFzIGR0bEdldFF1ZXJpZXNGb3JFbGVtZW50LFxuICBwcmV0dHlET00gYXMgZHRsUHJldHR5RE9NLFxuICBxdWVyaWVzIGFzIGR0bFF1ZXJpZXMsXG4gIHNjcmVlbiBhcyBkdGxTY3JlZW4sXG4gIHdhaXRGb3IgYXMgZHRsV2FpdEZvcixcbiAgd2FpdEZvckVsZW1lbnRUb0JlUmVtb3ZlZCBhcyBkdGxXYWl0Rm9yRWxlbWVudFRvQmVSZW1vdmVkLFxuICB3YWl0Rm9yT3B0aW9ucyBhcyBkdGxXYWl0Rm9yT3B0aW9ucyxcbiAgd2l0aGluIGFzIGR0bFdpdGhpbixcbn0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9kb20nO1xuaW1wb3J0IHsgQ29tcG9uZW50T3ZlcnJpZGUsIFJlbmRlckNvbXBvbmVudE9wdGlvbnMsIFJlbmRlclJlc3VsdCwgUmVuZGVyVGVtcGxhdGVPcHRpb25zIH0gZnJvbSAnLi9tb2RlbHMnO1xuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi9jb25maWcnO1xuXG5jb25zdCBtb3VudGVkRml4dHVyZXMgPSBuZXcgU2V0PENvbXBvbmVudEZpeHR1cmU8YW55Pj4oKTtcbmNvbnN0IHNhZmVJbmplY3QgPSBUZXN0QmVkLmluamVjdCB8fCBUZXN0QmVkLmdldDtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbmRlcjxDb21wb25lbnRUeXBlPihcbiAgY29tcG9uZW50OiBUeXBlPENvbXBvbmVudFR5cGU+LFxuICByZW5kZXJPcHRpb25zPzogUmVuZGVyQ29tcG9uZW50T3B0aW9uczxDb21wb25lbnRUeXBlPixcbik6IFByb21pc2U8UmVuZGVyUmVzdWx0PENvbXBvbmVudFR5cGUsIENvbXBvbmVudFR5cGU+PjtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW5kZXI8V3JhcHBlclR5cGUgPSBXcmFwcGVyQ29tcG9uZW50PihcbiAgdGVtcGxhdGU6IHN0cmluZyxcbiAgcmVuZGVyT3B0aW9ucz86IFJlbmRlclRlbXBsYXRlT3B0aW9uczxXcmFwcGVyVHlwZT4sXG4pOiBQcm9taXNlPFJlbmRlclJlc3VsdDxXcmFwcGVyVHlwZT4+O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyPFN1dFR5cGUsIFdyYXBwZXJUeXBlID0gU3V0VHlwZT4oXG4gIHN1dDogVHlwZTxTdXRUeXBlPiB8IHN0cmluZyxcbiAgcmVuZGVyT3B0aW9uczogUmVuZGVyQ29tcG9uZW50T3B0aW9uczxTdXRUeXBlPiB8IFJlbmRlclRlbXBsYXRlT3B0aW9uczxXcmFwcGVyVHlwZT4gPSB7fSxcbik6IFByb21pc2U8UmVuZGVyUmVzdWx0PFN1dFR5cGU+PiB7XG4gIGNvbnN0IHsgZG9tOiBkb21Db25maWcsIC4uLmdsb2JhbENvbmZpZyB9ID0gZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IHtcbiAgICBkZXRlY3RDaGFuZ2VzT25SZW5kZXIgPSB0cnVlLFxuICAgIGF1dG9EZXRlY3RDaGFuZ2VzID0gdHJ1ZSxcbiAgICBkZWNsYXJhdGlvbnMgPSBbXSxcbiAgICBpbXBvcnRzID0gW10sXG4gICAgcHJvdmlkZXJzID0gW10sXG4gICAgc2NoZW1hcyA9IFtdLFxuICAgIHF1ZXJpZXMsXG4gICAgd3JhcHBlciA9IFdyYXBwZXJDb21wb25lbnQgYXMgVHlwZTxXcmFwcGVyVHlwZT4sXG4gICAgY29tcG9uZW50UHJvcGVydGllcyA9IHt9LFxuICAgIGNvbXBvbmVudElucHV0cyA9IHt9LFxuICAgIGNvbXBvbmVudE91dHB1dHMgPSB7fSxcbiAgICBjb21wb25lbnRQcm92aWRlcnMgPSBbXSxcbiAgICBjaGlsZENvbXBvbmVudE92ZXJyaWRlcyA9IFtdLFxuICAgIGNvbXBvbmVudEltcG9ydHM6IGNvbXBvbmVudEltcG9ydHMsXG4gICAgZXhjbHVkZUNvbXBvbmVudERlY2xhcmF0aW9uID0gZmFsc2UsXG4gICAgcm91dGVzID0gW10sXG4gICAgcmVtb3ZlQW5ndWxhckF0dHJpYnV0ZXMgPSBmYWxzZSxcbiAgICBkZWZhdWx0SW1wb3J0cyA9IFtdLFxuICAgIGluaXRpYWxSb3V0ZSA9ICcnLFxuICAgIGRlZmVyQmxvY2tTdGF0ZXMgPSB1bmRlZmluZWQsXG4gICAgZGVmZXJCbG9ja0JlaGF2aW9yID0gdW5kZWZpbmVkLFxuICAgIGNvbmZpZ3VyZVRlc3RCZWQgPSAoKSA9PiB7XG4gICAgICAvKiBub29wKi9cbiAgICB9LFxuICB9ID0geyAuLi5nbG9iYWxDb25maWcsIC4uLnJlbmRlck9wdGlvbnMgfTtcblxuICBkdGxDb25maWd1cmUoe1xuICAgIGV2ZW50V3JhcHBlcjogKGNiKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBjYigpO1xuICAgICAgaWYgKGF1dG9EZXRlY3RDaGFuZ2VzKSB7XG4gICAgICAgIGRldGVjdENoYW5nZXNGb3JNb3VudGVkRml4dHVyZXMoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcbiAgICAuLi5kb21Db25maWcsXG4gIH0pO1xuXG4gIFRlc3RCZWQuY29uZmlndXJlVGVzdGluZ01vZHVsZSh7XG4gICAgZGVjbGFyYXRpb25zOiBhZGRBdXRvRGVjbGFyYXRpb25zKHN1dCwge1xuICAgICAgZGVjbGFyYXRpb25zLFxuICAgICAgZXhjbHVkZUNvbXBvbmVudERlY2xhcmF0aW9uLFxuICAgICAgd3JhcHBlcixcbiAgICB9KSxcbiAgICBpbXBvcnRzOiBhZGRBdXRvSW1wb3J0cyhzdXQsIHtcbiAgICAgIGltcG9ydHM6IGltcG9ydHMuY29uY2F0KGRlZmF1bHRJbXBvcnRzKSxcbiAgICAgIHJvdXRlcyxcbiAgICB9KSxcbiAgICBwcm92aWRlcnM6IFsuLi5wcm92aWRlcnNdLFxuICAgIHNjaGVtYXM6IFsuLi5zY2hlbWFzXSxcbiAgICBkZWZlckJsb2NrQmVoYXZpb3I6IGRlZmVyQmxvY2tCZWhhdmlvciA/PyBEZWZlckJsb2NrQmVoYXZpb3IuTWFudWFsLFxuICB9KTtcbiAgb3ZlcnJpZGVDb21wb25lbnRJbXBvcnRzKHN1dCwgY29tcG9uZW50SW1wb3J0cyk7XG4gIG92ZXJyaWRlQ2hpbGRDb21wb25lbnRQcm92aWRlcnMoY2hpbGRDb21wb25lbnRPdmVycmlkZXMpO1xuXG4gIGNvbmZpZ3VyZVRlc3RCZWQoVGVzdEJlZCk7XG5cbiAgYXdhaXQgVGVzdEJlZC5jb21waWxlQ29tcG9uZW50cygpO1xuXG4gIGNvbXBvbmVudFByb3ZpZGVyc1xuICAgIC5yZWR1Y2UoKGFjYywgcHJvdmlkZXIpID0+IGFjYy5jb25jYXQocHJvdmlkZXIpLCBbXSBhcyBhbnlbXSlcbiAgICAuZm9yRWFjaCgocDogYW55KSA9PiB7XG4gICAgICBjb25zdCB7IHByb3ZpZGUsIC4uLnByb3ZpZGVyIH0gPSBwO1xuICAgICAgVGVzdEJlZC5vdmVycmlkZVByb3ZpZGVyKHByb3ZpZGUsIHByb3ZpZGVyKTtcbiAgICB9KTtcblxuICBjb25zdCBjb21wb25lbnRDb250YWluZXIgPSBjcmVhdGVDb21wb25lbnRGaXh0dXJlKHN1dCwgd3JhcHBlcik7XG5cbiAgY29uc3Qgem9uZSA9IHNhZmVJbmplY3QoTmdab25lKTtcbiAgY29uc3Qgcm91dGVyID0gc2FmZUluamVjdChSb3V0ZXIpO1xuICBjb25zdCBfbmF2aWdhdGUgPSBhc3luYyAoZWxlbWVudE9yUGF0aDogRWxlbWVudCB8IHN0cmluZywgYmFzZVBhdGggPSAnJyk6IFByb21pc2U8Ym9vbGVhbj4gPT4ge1xuICAgIGNvbnN0IGhyZWYgPSB0eXBlb2YgZWxlbWVudE9yUGF0aCA9PT0gJ3N0cmluZycgPyBlbGVtZW50T3JQYXRoIDogZWxlbWVudE9yUGF0aC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKTtcbiAgICBjb25zdCBbcGF0aCwgcGFyYW1zXSA9IChiYXNlUGF0aCArIGhyZWYpLnNwbGl0KCc/Jyk7XG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSBwYXJhbXNcbiAgICAgID8gcGFyYW1zLnNwbGl0KCcmJykucmVkdWNlKChxcCwgcSkgPT4ge1xuICAgICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IHEuc3BsaXQoJz0nKTtcbiAgICAgICAgICBjb25zdCBjdXJyZW50VmFsdWUgPSBxcFtrZXldO1xuICAgICAgICAgIGlmICh0eXBlb2YgY3VycmVudFZhbHVlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcXBba2V5XSA9IHZhbHVlO1xuICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShjdXJyZW50VmFsdWUpKSB7XG4gICAgICAgICAgICBxcFtrZXldID0gWy4uLmN1cnJlbnRWYWx1ZSwgdmFsdWVdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBxcFtrZXldID0gW2N1cnJlbnRWYWx1ZSwgdmFsdWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcXA7XG4gICAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZyB8IHN0cmluZ1tdPilcbiAgICAgIDogdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgbmF2aWdhdGVPcHRpb25zOiBOYXZpZ2F0aW9uRXh0cmFzIHwgdW5kZWZpbmVkID0gcXVlcnlQYXJhbXNcbiAgICAgID8ge1xuICAgICAgICAgIHF1ZXJ5UGFyYW1zLFxuICAgICAgICB9XG4gICAgICA6IHVuZGVmaW5lZDtcblxuICAgIGNvbnN0IGRvTmF2aWdhdGUgPSAoKSA9PiB7XG4gICAgICByZXR1cm4gbmF2aWdhdGVPcHRpb25zID8gcm91dGVyPy5uYXZpZ2F0ZShbcGF0aF0sIG5hdmlnYXRlT3B0aW9ucykgOiByb3V0ZXI/Lm5hdmlnYXRlKFtwYXRoXSk7XG4gICAgfTtcblxuICAgIGxldCByZXN1bHQ7XG5cbiAgICBpZiAoem9uZSkge1xuICAgICAgYXdhaXQgem9uZS5ydW4oKCkgPT4gKHJlc3VsdCA9IGRvTmF2aWdhdGUoKSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQgPSBkb05hdmlnYXRlKCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQgPz8gZmFsc2U7XG4gIH07XG5cbiAgaWYgKGluaXRpYWxSb3V0ZSkgYXdhaXQgX25hdmlnYXRlKGluaXRpYWxSb3V0ZSk7XG5cbiAgaWYgKHR5cGVvZiByb3V0ZXI/LmluaXRpYWxOYXZpZ2F0aW9uID09PSAnZnVuY3Rpb24nKSB7XG4gICAgaWYgKHpvbmUpIHtcbiAgICAgIHpvbmUucnVuKCgpID0+IHJvdXRlci5pbml0aWFsTmF2aWdhdGlvbigpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcm91dGVyLmluaXRpYWxOYXZpZ2F0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgbGV0IGRldGVjdENoYW5nZXM6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3QgZml4dHVyZSA9IGF3YWl0IHJlbmRlckZpeHR1cmUoY29tcG9uZW50UHJvcGVydGllcywgY29tcG9uZW50SW5wdXRzLCBjb21wb25lbnRPdXRwdXRzKTtcblxuICBpZiAoZGVmZXJCbG9ja1N0YXRlcykge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGRlZmVyQmxvY2tTdGF0ZXMpKSB7XG4gICAgICBmb3IgKGNvbnN0IGRlZmVyQmxvY2tTdGF0ZSBvZiBkZWZlckJsb2NrU3RhdGVzKSB7XG4gICAgICAgIGF3YWl0IHJlbmRlckRlZmVyQmxvY2soZml4dHVyZSwgZGVmZXJCbG9ja1N0YXRlLmRlZmVyQmxvY2tTdGF0ZSwgZGVmZXJCbG9ja1N0YXRlLmRlZmVyQmxvY2tJbmRleCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHJlbmRlckRlZmVyQmxvY2soZml4dHVyZSwgZGVmZXJCbG9ja1N0YXRlcyk7XG4gICAgfVxuICB9XG5cbiAgbGV0IHJlbmRlcmVkUHJvcEtleXMgPSBPYmplY3Qua2V5cyhjb21wb25lbnRQcm9wZXJ0aWVzKTtcbiAgbGV0IHJlbmRlcmVkSW5wdXRLZXlzID0gT2JqZWN0LmtleXMoY29tcG9uZW50SW5wdXRzKTtcbiAgbGV0IHJlbmRlcmVkT3V0cHV0S2V5cyA9IE9iamVjdC5rZXlzKGNvbXBvbmVudE91dHB1dHMpO1xuICBjb25zdCByZXJlbmRlciA9IGFzeW5jIChcbiAgICBwcm9wZXJ0aWVzPzogUGljazxcbiAgICAgIFJlbmRlclRlbXBsYXRlT3B0aW9uczxTdXRUeXBlPixcbiAgICAgICdjb21wb25lbnRQcm9wZXJ0aWVzJyB8ICdjb21wb25lbnRJbnB1dHMnIHwgJ2NvbXBvbmVudE91dHB1dHMnIHwgJ2RldGVjdENoYW5nZXNPblJlbmRlcidcbiAgICA+ICYgeyBwYXJ0aWFsVXBkYXRlPzogYm9vbGVhbiB9LFxuICApID0+IHtcbiAgICBjb25zdCBuZXdDb21wb25lbnRJbnB1dHMgPSBwcm9wZXJ0aWVzPy5jb21wb25lbnRJbnB1dHMgPz8ge307XG4gICAgY29uc3QgY2hhbmdlc0luQ29tcG9uZW50SW5wdXQgPSB1cGRhdGUoXG4gICAgICBmaXh0dXJlLFxuICAgICAgcmVuZGVyZWRJbnB1dEtleXMsXG4gICAgICBuZXdDb21wb25lbnRJbnB1dHMsXG4gICAgICBzZXRDb21wb25lbnRJbnB1dHMsXG4gICAgICBwcm9wZXJ0aWVzPy5wYXJ0aWFsVXBkYXRlID8/IGZhbHNlLFxuICAgICk7XG4gICAgcmVuZGVyZWRJbnB1dEtleXMgPSBPYmplY3Qua2V5cyhuZXdDb21wb25lbnRJbnB1dHMpO1xuXG4gICAgY29uc3QgbmV3Q29tcG9uZW50T3V0cHV0cyA9IHByb3BlcnRpZXM/LmNvbXBvbmVudE91dHB1dHMgPz8ge307XG4gICAgZm9yIChjb25zdCBvdXRwdXRLZXkgb2YgcmVuZGVyZWRPdXRwdXRLZXlzKSB7XG4gICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuZXdDb21wb25lbnRPdXRwdXRzLCBvdXRwdXRLZXkpKSB7XG4gICAgICAgIGRlbGV0ZSAoZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSBhcyBhbnkpW291dHB1dEtleV07XG4gICAgICB9XG4gICAgfVxuICAgIHNldENvbXBvbmVudE91dHB1dHMoZml4dHVyZSwgbmV3Q29tcG9uZW50T3V0cHV0cyk7XG4gICAgcmVuZGVyZWRPdXRwdXRLZXlzID0gT2JqZWN0LmtleXMobmV3Q29tcG9uZW50T3V0cHV0cyk7XG5cbiAgICBjb25zdCBuZXdDb21wb25lbnRQcm9wcyA9IHByb3BlcnRpZXM/LmNvbXBvbmVudFByb3BlcnRpZXMgPz8ge307XG4gICAgY29uc3QgY2hhbmdlc0luQ29tcG9uZW50UHJvcHMgPSB1cGRhdGUoXG4gICAgICBmaXh0dXJlLFxuICAgICAgcmVuZGVyZWRQcm9wS2V5cyxcbiAgICAgIG5ld0NvbXBvbmVudFByb3BzLFxuICAgICAgc2V0Q29tcG9uZW50UHJvcGVydGllcyxcbiAgICAgIHByb3BlcnRpZXM/LnBhcnRpYWxVcGRhdGUgPz8gZmFsc2UsXG4gICAgKTtcbiAgICByZW5kZXJlZFByb3BLZXlzID0gT2JqZWN0LmtleXMobmV3Q29tcG9uZW50UHJvcHMpO1xuXG4gICAgaWYgKGhhc09uQ2hhbmdlc0hvb2soZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSkpIHtcbiAgICAgIGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UubmdPbkNoYW5nZXMoe1xuICAgICAgICAuLi5jaGFuZ2VzSW5Db21wb25lbnRJbnB1dCxcbiAgICAgICAgLi4uY2hhbmdlc0luQ29tcG9uZW50UHJvcHMsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAocHJvcGVydGllcz8uZGV0ZWN0Q2hhbmdlc09uUmVuZGVyICE9PSBmYWxzZSkge1xuICAgICAgZml4dHVyZS5jb21wb25lbnRSZWYuaW5qZWN0b3IuZ2V0KENoYW5nZURldGVjdG9yUmVmKS5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IG5hdmlnYXRlID0gYXN5bmMgKGVsZW1lbnRPclBhdGg6IEVsZW1lbnQgfCBzdHJpbmcsIGJhc2VQYXRoID0gJycpOiBQcm9taXNlPGJvb2xlYW4+ID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBfbmF2aWdhdGUoZWxlbWVudE9yUGF0aCwgYmFzZVBhdGgpO1xuICAgIGRldGVjdENoYW5nZXMoKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZml4dHVyZSxcbiAgICBkZXRlY3RDaGFuZ2VzOiAoKSA9PiBkZXRlY3RDaGFuZ2VzKCksXG4gICAgbmF2aWdhdGUsXG4gICAgcmVyZW5kZXIsXG4gICAgcmVuZGVyRGVmZXJCbG9jazogYXN5bmMgKGRlZmVyQmxvY2tTdGF0ZTogRGVmZXJCbG9ja1N0YXRlLCBkZWZlckJsb2NrSW5kZXg/OiBudW1iZXIpID0+IHtcbiAgICAgIGF3YWl0IHJlbmRlckRlZmVyQmxvY2soZml4dHVyZSwgZGVmZXJCbG9ja1N0YXRlLCBkZWZlckJsb2NrSW5kZXgpO1xuICAgIH0sXG4gICAgZGVidWdFbGVtZW50OiBmaXh0dXJlLmRlYnVnRWxlbWVudCxcbiAgICBjb250YWluZXI6IGZpeHR1cmUubmF0aXZlRWxlbWVudCxcbiAgICBkZWJ1ZzogKGVsZW1lbnQgPSBmaXh0dXJlLm5hdGl2ZUVsZW1lbnQsIG1heExlbmd0aCwgb3B0aW9ucykgPT5cbiAgICAgIEFycmF5LmlzQXJyYXkoZWxlbWVudClcbiAgICAgICAgPyBlbGVtZW50LmZvckVhY2goKGUpID0+IGNvbnNvbGUubG9nKGR0bFByZXR0eURPTShlLCBtYXhMZW5ndGgsIG9wdGlvbnMpKSlcbiAgICAgICAgOiBjb25zb2xlLmxvZyhkdGxQcmV0dHlET00oZWxlbWVudCwgbWF4TGVuZ3RoLCBvcHRpb25zKSksXG4gICAgLi4ucmVwbGFjZUZpbmRXaXRoRmluZEFuZERldGVjdENoYW5nZXMoZHRsR2V0UXVlcmllc0ZvckVsZW1lbnQoZml4dHVyZS5uYXRpdmVFbGVtZW50LCBxdWVyaWVzKSksXG4gIH07XG5cbiAgYXN5bmMgZnVuY3Rpb24gcmVuZGVyRml4dHVyZShcbiAgICBwcm9wZXJ0aWVzOiBQYXJ0aWFsPFN1dFR5cGU+LFxuICAgIGlucHV0czogUGFydGlhbDxTdXRUeXBlPixcbiAgICBvdXRwdXRzOiBQYXJ0aWFsPFN1dFR5cGU+LFxuICApOiBQcm9taXNlPENvbXBvbmVudEZpeHR1cmU8U3V0VHlwZT4+IHtcbiAgICBjb25zdCBjcmVhdGVkRml4dHVyZSA9IGF3YWl0IGNyZWF0ZUNvbXBvbmVudChjb21wb25lbnRDb250YWluZXIpO1xuICAgIHNldENvbXBvbmVudFByb3BlcnRpZXMoY3JlYXRlZEZpeHR1cmUsIHByb3BlcnRpZXMpO1xuICAgIHNldENvbXBvbmVudElucHV0cyhjcmVhdGVkRml4dHVyZSwgaW5wdXRzKTtcbiAgICBzZXRDb21wb25lbnRPdXRwdXRzKGNyZWF0ZWRGaXh0dXJlLCBvdXRwdXRzKTtcblxuICAgIGlmIChyZW1vdmVBbmd1bGFyQXR0cmlidXRlcykge1xuICAgICAgY3JlYXRlZEZpeHR1cmUubmF0aXZlRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ25nLXZlcnNpb24nKTtcbiAgICAgIGNvbnN0IGlkQXR0cmlidXRlID0gY3JlYXRlZEZpeHR1cmUubmF0aXZlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2lkJyk7XG4gICAgICBpZiAoaWRBdHRyaWJ1dGUgJiYgaWRBdHRyaWJ1dGUuc3RhcnRzV2l0aCgncm9vdCcpKSB7XG4gICAgICAgIGNyZWF0ZWRGaXh0dXJlLm5hdGl2ZUVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdpZCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIG1vdW50ZWRGaXh0dXJlcy5hZGQoY3JlYXRlZEZpeHR1cmUpO1xuXG4gICAgbGV0IGlzQWxpdmUgPSB0cnVlO1xuICAgIGNyZWF0ZWRGaXh0dXJlLmNvbXBvbmVudFJlZi5vbkRlc3Ryb3koKCkgPT4gKGlzQWxpdmUgPSBmYWxzZSkpO1xuXG4gICAgaWYgKGhhc09uQ2hhbmdlc0hvb2soY3JlYXRlZEZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UpICYmIE9iamVjdC5rZXlzKHByb3BlcnRpZXMpLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGNoYW5nZXMgPSBnZXRDaGFuZ2VzT2JqKG51bGwsIGNvbXBvbmVudFByb3BlcnRpZXMpO1xuICAgICAgY3JlYXRlZEZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UubmdPbkNoYW5nZXMoY2hhbmdlcyk7XG4gICAgfVxuXG4gICAgZGV0ZWN0Q2hhbmdlcyA9ICgpID0+IHtcbiAgICAgIGlmIChpc0FsaXZlKSB7XG4gICAgICAgIGNyZWF0ZWRGaXh0dXJlLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKGRldGVjdENoYW5nZXNPblJlbmRlcikge1xuICAgICAgZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH1cblxuICAgIHJldHVybiBjcmVhdGVkRml4dHVyZTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVDb21wb25lbnQ8U3V0VHlwZT4oY29tcG9uZW50OiBUeXBlPFN1dFR5cGU+KTogUHJvbWlzZTxDb21wb25lbnRGaXh0dXJlPFN1dFR5cGU+PiB7XG4gIC8qIE1ha2Ugc3VyZSBhbmd1bGFyIGFwcGxpY2F0aW9uIGlzIGluaXRpYWxpemVkIGJlZm9yZSBjcmVhdGluZyBjb21wb25lbnQgKi9cbiAgYXdhaXQgc2FmZUluamVjdChBcHBsaWNhdGlvbkluaXRTdGF0dXMpLmRvbmVQcm9taXNlO1xuICByZXR1cm4gVGVzdEJlZC5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQ29tcG9uZW50Rml4dHVyZTxTdXRUeXBlLCBXcmFwcGVyVHlwZT4oXG4gIHN1dDogVHlwZTxTdXRUeXBlPiB8IHN0cmluZyxcbiAgd3JhcHBlcjogVHlwZTxXcmFwcGVyVHlwZT4sXG4pOiBUeXBlPGFueT4ge1xuICBpZiAodHlwZW9mIHN1dCA9PT0gJ3N0cmluZycpIHtcbiAgICBUZXN0QmVkLm92ZXJyaWRlVGVtcGxhdGUod3JhcHBlciwgc3V0KTtcbiAgICByZXR1cm4gd3JhcHBlcjtcbiAgfVxuICByZXR1cm4gc3V0O1xufVxuXG5mdW5jdGlvbiBzZXRDb21wb25lbnRQcm9wZXJ0aWVzPFN1dFR5cGU+KFxuICBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPFN1dFR5cGU+LFxuICBjb21wb25lbnRQcm9wZXJ0aWVzOiBSZW5kZXJUZW1wbGF0ZU9wdGlvbnM8U3V0VHlwZSwgYW55PlsnY29tcG9uZW50UHJvcGVydGllcyddID0ge30sXG4pIHtcbiAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoY29tcG9uZW50UHJvcGVydGllcykpIHtcbiAgICBjb25zdCBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcigoZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSBhcyBhbnkpLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwga2V5KTtcbiAgICBsZXQgX3ZhbHVlID0gY29tcG9uZW50UHJvcGVydGllc1trZXldO1xuICAgIGNvbnN0IGRlZmF1bHRHZXR0ZXIgPSAoKSA9PiBfdmFsdWU7XG4gICAgY29uc3QgZXh0ZW5kZWRTZXR0ZXIgPSAodmFsdWU6IGFueSkgPT4ge1xuICAgICAgX3ZhbHVlID0gdmFsdWU7XG4gICAgICBkZXNjcmlwdG9yPy5zZXQ/LmNhbGwoZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSwgX3ZhbHVlKTtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH07XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSwga2V5LCB7XG4gICAgICBnZXQ6IGRlc2NyaXB0b3I/LmdldCB8fCBkZWZhdWx0R2V0dGVyLFxuICAgICAgc2V0OiBleHRlbmRlZFNldHRlcixcbiAgICAgIC8vIEFsbG93IHRoZSBwcm9wZXJ0eSB0byBiZSBkZWZpbmVkIGFnYWluIGxhdGVyLlxuICAgICAgLy8gVGhpcyBoYXBwZW5zIHdoZW4gdGhlIGNvbXBvbmVudCBwcm9wZXJ0aWVzIGFyZSB1cGRhdGVkIGFmdGVyIGluaXRpYWwgcmVuZGVyLlxuICAgICAgLy8gRm9yIEplc3QgdGhpcyBpcyBgdHJ1ZWAgYnkgZGVmYXVsdCwgZm9yIEthcm1hIGFuZCBhIHJlYWwgYnJvd3NlciB0aGUgZGVmYXVsdCBpcyBgZmFsc2VgXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgfSk7XG5cbiAgICBkZXNjcmlwdG9yPy5zZXQ/LmNhbGwoZml4dHVyZS5jb21wb25lbnRJbnN0YW5jZSwgX3ZhbHVlKTtcbiAgfVxuICByZXR1cm4gZml4dHVyZTtcbn1cblxuZnVuY3Rpb24gc2V0Q29tcG9uZW50T3V0cHV0czxTdXRUeXBlPihcbiAgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxTdXRUeXBlPixcbiAgY29tcG9uZW50T3V0cHV0czogUmVuZGVyVGVtcGxhdGVPcHRpb25zPFN1dFR5cGUsIGFueT5bJ2NvbXBvbmVudE91dHB1dHMnXSA9IHt9LFxuKSB7XG4gIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhjb21wb25lbnRPdXRwdXRzKSkge1xuICAgIChmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlIGFzIGFueSlbbmFtZV0gPSB2YWx1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRDb21wb25lbnRJbnB1dHM8U3V0VHlwZT4oXG4gIGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8U3V0VHlwZT4sXG4gIGNvbXBvbmVudElucHV0czogUmVuZGVyVGVtcGxhdGVPcHRpb25zPFN1dFR5cGU+Wydjb21wb25lbnRJbnB1dHMnXSA9IHt9LFxuKSB7XG4gIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhjb21wb25lbnRJbnB1dHMpKSB7XG4gICAgZml4dHVyZS5jb21wb25lbnRSZWYuc2V0SW5wdXQobmFtZSwgdmFsdWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG92ZXJyaWRlQ29tcG9uZW50SW1wb3J0czxTdXRUeXBlPihzdXQ6IFR5cGU8U3V0VHlwZT4gfCBzdHJpbmcsIGltcG9ydHM6IChUeXBlPGFueT4gfCBhbnlbXSlbXSB8IHVuZGVmaW5lZCkge1xuICBpZiAoaW1wb3J0cykge1xuICAgIGlmICh0eXBlb2Ygc3V0ID09PSAnZnVuY3Rpb24nICYmIGlzU3RhbmRhbG9uZShzdXQpKSB7XG4gICAgICBUZXN0QmVkLm92ZXJyaWRlQ29tcG9uZW50KHN1dCwgeyBzZXQ6IHsgaW1wb3J0cyB9IH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBFcnJvciB3aGlsZSByZW5kZXJpbmcgJHtzdXR9OiBDYW5ub3Qgc3BlY2lmeSBjb21wb25lbnRJbXBvcnRzIG9uIGEgdGVtcGxhdGUgb3Igbm9uLXN0YW5kYWxvbmUgY29tcG9uZW50LmAsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBvdmVycmlkZUNoaWxkQ29tcG9uZW50UHJvdmlkZXJzKGNvbXBvbmVudE92ZXJyaWRlczogQ29tcG9uZW50T3ZlcnJpZGU8YW55PltdKSB7XG4gIGNvbXBvbmVudE92ZXJyaWRlcz8uZm9yRWFjaCgoeyBjb21wb25lbnQsIHByb3ZpZGVycyB9KSA9PiB7XG4gICAgVGVzdEJlZC5vdmVycmlkZUNvbXBvbmVudChjb21wb25lbnQsIHsgc2V0OiB7IHByb3ZpZGVycyB9IH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaGFzT25DaGFuZ2VzSG9vazxTdXRUeXBlPihjb21wb25lbnRJbnN0YW5jZTogU3V0VHlwZSk6IGNvbXBvbmVudEluc3RhbmNlIGlzIFN1dFR5cGUgJiBPbkNoYW5nZXMge1xuICByZXR1cm4gKFxuICAgIGNvbXBvbmVudEluc3RhbmNlICE9PSBudWxsICYmXG4gICAgdHlwZW9mIGNvbXBvbmVudEluc3RhbmNlID09PSAnb2JqZWN0JyAmJlxuICAgICduZ09uQ2hhbmdlcycgaW4gY29tcG9uZW50SW5zdGFuY2UgJiZcbiAgICB0eXBlb2YgKGNvbXBvbmVudEluc3RhbmNlIGFzIFN1dFR5cGUgJiBPbkNoYW5nZXMpLm5nT25DaGFuZ2VzID09PSAnZnVuY3Rpb24nXG4gICk7XG59XG5cbmZ1bmN0aW9uIGdldENoYW5nZXNPYmoob2xkUHJvcHM6IFJlY29yZDxzdHJpbmcsIGFueT4gfCBudWxsLCBuZXdQcm9wczogUmVjb3JkPHN0cmluZywgYW55Pikge1xuICBjb25zdCBpc0ZpcnN0Q2hhbmdlID0gb2xkUHJvcHMgPT09IG51bGw7XG4gIHJldHVybiBPYmplY3Qua2V5cyhuZXdQcm9wcykucmVkdWNlPFNpbXBsZUNoYW5nZXM+KFxuICAgIChjaGFuZ2VzLCBrZXkpID0+ICh7XG4gICAgICAuLi5jaGFuZ2VzLFxuICAgICAgW2tleV06IG5ldyBTaW1wbGVDaGFuZ2UoaXNGaXJzdENoYW5nZSA/IG51bGwgOiBvbGRQcm9wc1trZXldLCBuZXdQcm9wc1trZXldLCBpc0ZpcnN0Q2hhbmdlKSxcbiAgICB9KSxcbiAgICB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICApO1xufVxuXG5mdW5jdGlvbiB1cGRhdGU8U3V0VHlwZT4oXG4gIGZpeHR1cmU6IENvbXBvbmVudEZpeHR1cmU8U3V0VHlwZT4sXG4gIHByZXZSZW5kZXJlZEtleXM6IHN0cmluZ1tdLFxuICBuZXdWYWx1ZXM6IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gIHVwZGF0ZUZ1bmN0aW9uOiAoXG4gICAgZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxTdXRUeXBlPixcbiAgICB2YWx1ZXM6IFJlbmRlclRlbXBsYXRlT3B0aW9uczxTdXRUeXBlPlsnY29tcG9uZW50SW5wdXRzJyB8ICdjb21wb25lbnRQcm9wZXJ0aWVzJ10sXG4gICkgPT4gdm9pZCxcbiAgcGFydGlhbFVwZGF0ZTogYm9vbGVhbixcbikge1xuICBjb25zdCBjb21wb25lbnRJbnN0YW5jZSA9IGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2UgYXMgUmVjb3JkPHN0cmluZywgYW55PjtcbiAgY29uc3Qgc2ltcGxlQ2hhbmdlczogU2ltcGxlQ2hhbmdlcyA9IHt9O1xuXG4gIGZvciAoY29uc3Qga2V5IG9mIHByZXZSZW5kZXJlZEtleXMpIHtcbiAgICBpZiAoIXBhcnRpYWxVcGRhdGUgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChuZXdWYWx1ZXMsIGtleSkpIHtcbiAgICAgIHNpbXBsZUNoYW5nZXNba2V5XSA9IG5ldyBTaW1wbGVDaGFuZ2UoY29tcG9uZW50SW5zdGFuY2Vba2V5XSwgdW5kZWZpbmVkLCBmYWxzZSk7XG4gICAgICBkZWxldGUgY29tcG9uZW50SW5zdGFuY2Vba2V5XTtcbiAgICB9XG4gIH1cblxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhuZXdWYWx1ZXMpKSB7XG4gICAgaWYgKHZhbHVlICE9PSBjb21wb25lbnRJbnN0YW5jZVtrZXldKSB7XG4gICAgICBzaW1wbGVDaGFuZ2VzW2tleV0gPSBuZXcgU2ltcGxlQ2hhbmdlKGNvbXBvbmVudEluc3RhbmNlW2tleV0sIHZhbHVlLCBmYWxzZSk7XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlRnVuY3Rpb24oZml4dHVyZSwgbmV3VmFsdWVzKTtcblxuICByZXR1cm4gc2ltcGxlQ2hhbmdlcztcbn1cblxuZnVuY3Rpb24gYWRkQXV0b0RlY2xhcmF0aW9uczxTdXRUeXBlPihcbiAgc3V0OiBUeXBlPFN1dFR5cGU+IHwgc3RyaW5nLFxuICB7XG4gICAgZGVjbGFyYXRpb25zID0gW10sXG4gICAgZXhjbHVkZUNvbXBvbmVudERlY2xhcmF0aW9uLFxuICAgIHdyYXBwZXIsXG4gIH06IFBpY2s8UmVuZGVyVGVtcGxhdGVPcHRpb25zPGFueT4sICdkZWNsYXJhdGlvbnMnIHwgJ2V4Y2x1ZGVDb21wb25lbnREZWNsYXJhdGlvbicgfCAnd3JhcHBlcic+LFxuKSB7XG4gIGlmICh0eXBlb2Ygc3V0ID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBbLi4uZGVjbGFyYXRpb25zLCB3cmFwcGVyXTtcbiAgfVxuXG4gIGNvbnN0IGNvbXBvbmVudHMgPSAoKSA9PiAoZXhjbHVkZUNvbXBvbmVudERlY2xhcmF0aW9uIHx8IGlzU3RhbmRhbG9uZShzdXQpID8gW10gOiBbc3V0XSk7XG4gIHJldHVybiBbLi4uZGVjbGFyYXRpb25zLCAuLi5jb21wb25lbnRzKCldO1xufVxuXG5mdW5jdGlvbiBhZGRBdXRvSW1wb3J0czxTdXRUeXBlPihcbiAgc3V0OiBUeXBlPFN1dFR5cGU+IHwgc3RyaW5nLFxuICB7IGltcG9ydHMgPSBbXSwgcm91dGVzIH06IFBpY2s8UmVuZGVyQ29tcG9uZW50T3B0aW9uczxhbnk+LCAnaW1wb3J0cycgfCAncm91dGVzJz4sXG4pIHtcbiAgY29uc3QgYW5pbWF0aW9ucyA9ICgpID0+IHtcbiAgICBjb25zdCBhbmltYXRpb25Jc0RlZmluZWQgPVxuICAgICAgaW1wb3J0cy5pbmRleE9mKE5vb3BBbmltYXRpb25zTW9kdWxlKSA+IC0xIHx8IGltcG9ydHMuaW5kZXhPZihCcm93c2VyQW5pbWF0aW9uc01vZHVsZSkgPiAtMTtcbiAgICByZXR1cm4gYW5pbWF0aW9uSXNEZWZpbmVkID8gW10gOiBbTm9vcEFuaW1hdGlvbnNNb2R1bGVdO1xuICB9O1xuXG4gIGNvbnN0IHJvdXRpbmcgPSAoKSA9PiAocm91dGVzID8gW1JvdXRlclRlc3RpbmdNb2R1bGUud2l0aFJvdXRlcyhyb3V0ZXMpXSA6IFtdKTtcbiAgY29uc3QgY29tcG9uZW50cyA9ICgpID0+ICh0eXBlb2Ygc3V0ICE9PSAnc3RyaW5nJyAmJiBpc1N0YW5kYWxvbmUoc3V0KSA/IFtzdXRdIDogW10pO1xuICByZXR1cm4gWy4uLmltcG9ydHMsIC4uLmNvbXBvbmVudHMoKSwgLi4uYW5pbWF0aW9ucygpLCAuLi5yb3V0aW5nKCldO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZW5kZXJEZWZlckJsb2NrPFN1dFR5cGU+KFxuICBmaXh0dXJlOiBDb21wb25lbnRGaXh0dXJlPFN1dFR5cGU+LFxuICBkZWZlckJsb2NrU3RhdGU6IERlZmVyQmxvY2tTdGF0ZSxcbiAgZGVmZXJCbG9ja0luZGV4PzogbnVtYmVyLFxuKSB7XG4gIGNvbnN0IGRlZmVyQmxvY2tGaXh0dXJlcyA9IGF3YWl0IGZpeHR1cmUuZ2V0RGVmZXJCbG9ja3MoKTtcblxuICBpZiAoZGVmZXJCbG9ja0luZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoZGVmZXJCbG9ja0luZGV4IDwgMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdkZWZlckJsb2NrSW5kZXggbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpO1xuICAgIH1cblxuICAgIGNvbnN0IGRlZmVyQmxvY2tGaXh0dXJlID0gZGVmZXJCbG9ja0ZpeHR1cmVzW2RlZmVyQmxvY2tJbmRleF07XG4gICAgaWYgKCFkZWZlckJsb2NrRml4dHVyZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZmluZCBhIGRlZmVycmFibGUgYmxvY2sgd2l0aCBpbmRleCAnJHtkZWZlckJsb2NrSW5kZXh9J2ApO1xuICAgIH1cbiAgICBhd2FpdCBkZWZlckJsb2NrRml4dHVyZS5yZW5kZXIoZGVmZXJCbG9ja1N0YXRlKTtcbiAgfSBlbHNlIHtcbiAgICBmb3IgKGNvbnN0IGRlZmVyQmxvY2tGaXh0dXJlIG9mIGRlZmVyQmxvY2tGaXh0dXJlcykge1xuICAgICAgYXdhaXQgZGVmZXJCbG9ja0ZpeHR1cmUucmVuZGVyKGRlZmVyQmxvY2tTdGF0ZSk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogV3JhcCB3YWl0Rm9yIHRvIGludm9rZSB0aGUgQW5ndWxhciBjaGFuZ2UgZGV0ZWN0aW9uIGN5Y2xlIGJlZm9yZSBpbnZva2luZyB0aGUgY2FsbGJhY2tcbiAqL1xuYXN5bmMgZnVuY3Rpb24gd2FpdEZvcldyYXBwZXI8VD4oXG4gIGRldGVjdENoYW5nZXM6ICgpID0+IHZvaWQsXG4gIGNhbGxiYWNrOiAoKSA9PiBUIGV4dGVuZHMgUHJvbWlzZTxhbnk+ID8gbmV2ZXIgOiBULFxuICBvcHRpb25zPzogZHRsV2FpdEZvck9wdGlvbnMsXG4pOiBQcm9taXNlPFQ+IHtcbiAgbGV0IGluRmFrZUFzeW5jID0gdHJ1ZTtcbiAgdHJ5IHtcbiAgICB0aWNrKDApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpbkZha2VBc3luYyA9IGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IGR0bFdhaXRGb3IoKCkgPT4ge1xuICAgIHNldFRpbWVvdXQoKCkgPT4gZGV0ZWN0Q2hhbmdlcygpLCAwKTtcbiAgICBpZiAoaW5GYWtlQXN5bmMpIHtcbiAgICAgIHRpY2soMCk7XG4gICAgfVxuICAgIHJldHVybiBjYWxsYmFjaygpO1xuICB9LCBvcHRpb25zKTtcbn1cblxuLyoqXG4gKiBXcmFwIHdhaXRGb3JFbGVtZW50VG9CZVJlbW92ZWRXcmFwcGVyIHRvIHBva2UgdGhlIEFuZ3VsYXIgY2hhbmdlIGRldGVjdGlvbiBjeWNsZSBiZWZvcmUgaW52b2tpbmcgdGhlIGNhbGxiYWNrXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JFbGVtZW50VG9CZVJlbW92ZWRXcmFwcGVyPFQ+KFxuICBkZXRlY3RDaGFuZ2VzOiAoKSA9PiB2b2lkLFxuICBjYWxsYmFjazogKCgpID0+IFQpIHwgVCxcbiAgb3B0aW9ucz86IGR0bFdhaXRGb3JPcHRpb25zLFxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGxldCBjYjogKCkgPT4gVDtcbiAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIGNvbnN0IGVsZW1lbnRzID0gKEFycmF5LmlzQXJyYXkoY2FsbGJhY2spID8gY2FsbGJhY2sgOiBbY2FsbGJhY2tdKSBhcyBFbGVtZW50W107XG4gICAgY29uc3QgZ2V0UmVtYWluaW5nRWxlbWVudHMgPSBlbGVtZW50cy5tYXAoKGVsZW1lbnQpID0+IHtcbiAgICAgIGxldCBwYXJlbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQgYXMgRWxlbWVudDtcbiAgICAgIHdoaWxlIChwYXJlbnQucGFyZW50RWxlbWVudCkge1xuICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50RWxlbWVudDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoKSA9PiAocGFyZW50LmNvbnRhaW5zKGVsZW1lbnQpID8gZWxlbWVudCA6IG51bGwpO1xuICAgIH0pO1xuICAgIGNiID0gKCkgPT4gZ2V0UmVtYWluaW5nRWxlbWVudHMubWFwKChjKSA9PiBjKCkpLmZpbmQoQm9vbGVhbikgYXMgdW5rbm93biBhcyBUO1xuICB9IGVsc2Uge1xuICAgIGNiID0gY2FsbGJhY2sgYXMgKCkgPT4gVDtcbiAgfVxuXG4gIHJldHVybiBhd2FpdCBkdGxXYWl0Rm9yRWxlbWVudFRvQmVSZW1vdmVkKCgpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSBjYigpO1xuICAgIGRldGVjdENoYW5nZXMoKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LCBvcHRpb25zKTtcbn1cblxuZnVuY3Rpb24gY2xlYW51cCgpIHtcbiAgbW91bnRlZEZpeHR1cmVzLmZvckVhY2goY2xlYW51cEF0Rml4dHVyZSk7XG59XG5cbmZ1bmN0aW9uIGNsZWFudXBBdEZpeHR1cmUoZml4dHVyZTogQ29tcG9uZW50Rml4dHVyZTxhbnk+KSB7XG4gIGZpeHR1cmUuZGVzdHJveSgpO1xuXG4gIGlmICghZml4dHVyZS5uYXRpdmVFbGVtZW50LmdldEF0dHJpYnV0ZSgnbmctdmVyc2lvbicpICYmIGZpeHR1cmUubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlID09PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmaXh0dXJlLm5hdGl2ZUVsZW1lbnQpO1xuICB9IGVsc2UgaWYgKCFmaXh0dXJlLm5hdGl2ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdpZCcpICYmIGRvY3VtZW50LmJvZHkuY2hpbGRyZW4/LlswXSA9PT0gZml4dHVyZS5uYXRpdmVFbGVtZW50KSB7XG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmaXh0dXJlLm5hdGl2ZUVsZW1lbnQpO1xuICB9XG5cbiAgbW91bnRlZEZpeHR1cmVzLmRlbGV0ZShmaXh0dXJlKTtcbn1cblxuLy8gaWYgd2UncmUgcnVubmluZyBpbiBhIHRlc3QgcnVubmVyIHRoYXQgc3VwcG9ydHMgYWZ0ZXJFYWNoXG4vLyB0aGVuIHdlJ2xsIGF1dG9tYXRpY2FsbHkgcnVuIGNsZWFudXAgYWZ0ZXJFYWNoIHRlc3Rcbi8vIHRoaXMgZW5zdXJlcyB0aGF0IHRlc3RzIHJ1biBpbiBpc29sYXRpb24gZnJvbSBlYWNoIG90aGVyXG4vLyBpZiB5b3UgZG9uJ3QgbGlrZSB0aGlzLCBzZXQgdGhlIEFUTF9TS0lQX0FVVE9fQ0xFQU5VUCBlbnYgdmFyaWFibGUgdG8gJ3RydWUnXG5pZiAodHlwZW9mIHByb2Nlc3MgPT09ICd1bmRlZmluZWQnIHx8ICFwcm9jZXNzLmVudj8uQVRMX1NLSVBfQVVUT19DTEVBTlVQKSB7XG4gIGlmICh0eXBlb2YgYWZ0ZXJFYWNoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgIGNsZWFudXAoKTtcbiAgICB9KTtcbiAgfVxufVxuXG5AQ29tcG9uZW50KHsgc2VsZWN0b3I6ICdhdGwtd3JhcHBlci1jb21wb25lbnQnLCB0ZW1wbGF0ZTogJycgfSlcbmNsYXNzIFdyYXBwZXJDb21wb25lbnQge31cblxuLyoqXG4gKiBXcmFwIGZpbmRCeSBxdWVyaWVzIHRvIHBva2UgdGhlIEFuZ3VsYXIgY2hhbmdlIGRldGVjdGlvbiBjeWNsZVxuICovXG5mdW5jdGlvbiByZXBsYWNlRmluZFdpdGhGaW5kQW5kRGV0ZWN0Q2hhbmdlczxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55Pj4ob3JpZ2luYWxRdWVyaWVzRm9yQ29udGFpbmVyOiBUKTogVCB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhvcmlnaW5hbFF1ZXJpZXNGb3JDb250YWluZXIpLnJlZHVjZSgobmV3UXVlcmllcywga2V5KSA9PiB7XG4gICAgY29uc3QgZ2V0QnlRdWVyeSA9IG9yaWdpbmFsUXVlcmllc0ZvckNvbnRhaW5lcltrZXkucmVwbGFjZSgnZmluZCcsICdnZXQnKV07XG4gICAgaWYgKGtleS5zdGFydHNXaXRoKCdmaW5kJykgJiYgZ2V0QnlRdWVyeSkge1xuICAgICAgbmV3UXVlcmllc1trZXldID0gYXN5bmMgKC4uLnF1ZXJ5T3B0aW9uczogYW55W10pID0+IHtcbiAgICAgICAgY29uc3Qgd2FpdE9wdGlvbnMgPSBxdWVyeU9wdGlvbnMubGVuZ3RoID09PSAzID8gcXVlcnlPcHRpb25zLnBvcCgpIDogdW5kZWZpbmVkO1xuICAgICAgICAvLyBvcmlnaW5hbCBpbXBsZW1lbnRhdGlvbiBhdCBodHRwczovL2dpdGh1Yi5jb20vdGVzdGluZy1saWJyYXJ5L2RvbS10ZXN0aW5nLWxpYnJhcnkvYmxvYi9tYWluL3NyYy9xdWVyeS1oZWxwZXJzLmpzXG4gICAgICAgIHJldHVybiBhd2FpdCB3YWl0Rm9yV3JhcHBlcihkZXRlY3RDaGFuZ2VzRm9yTW91bnRlZEZpeHR1cmVzLCAoKSA9PiBnZXRCeVF1ZXJ5KC4uLnF1ZXJ5T3B0aW9ucyksIHdhaXRPcHRpb25zKTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld1F1ZXJpZXNba2V5XSA9IG9yaWdpbmFsUXVlcmllc0ZvckNvbnRhaW5lcltrZXldO1xuICAgIH1cblxuICAgIHJldHVybiBuZXdRdWVyaWVzO1xuICB9LCB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+KSBhcyBUO1xufVxuXG4vKipcbiAqIENhbGwgZGV0ZWN0Q2hhbmdlcyBmb3IgYWxsIGZpeHR1cmVzXG4gKi9cbmZ1bmN0aW9uIGRldGVjdENoYW5nZXNGb3JNb3VudGVkRml4dHVyZXMoKSB7XG4gIG1vdW50ZWRGaXh0dXJlcy5mb3JFYWNoKChmaXh0dXJlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICBpZiAoIWVyci5tZXNzYWdlLnN0YXJ0c1dpdGgoJ1ZpZXdEZXN0cm95ZWRFcnJvcicpKSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIFJlLWV4cG9ydCBzY3JlZW4gd2l0aCBwYXRjaGVkIHF1ZXJpZXNcbiAqL1xuY29uc3Qgc2NyZWVuID0gcmVwbGFjZUZpbmRXaXRoRmluZEFuZERldGVjdENoYW5nZXMoZHRsU2NyZWVuKTtcblxuLyoqXG4gKiBSZS1leHBvcnQgd2l0aGluIHdpdGggcGF0Y2hlZCBxdWVyaWVzXG4gKi9cbmNvbnN0IHdpdGhpbiA9IDxRdWVyaWVzVG9CaW5kIGV4dGVuZHMgUXVlcmllcyA9IHR5cGVvZiBkdGxRdWVyaWVzLCBUIGV4dGVuZHMgUXVlcmllc1RvQmluZCA9IFF1ZXJpZXNUb0JpbmQ+KFxuICBlbGVtZW50OiBIVE1MRWxlbWVudCxcbiAgcXVlcmllc1RvQmluZD86IFQsXG4pOiBCb3VuZEZ1bmN0aW9uczxUPiA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGR0bFdpdGhpbjxUPihlbGVtZW50LCBxdWVyaWVzVG9CaW5kKTtcbiAgcmV0dXJuIHJlcGxhY2VGaW5kV2l0aEZpbmRBbmREZXRlY3RDaGFuZ2VzKGNvbnRhaW5lcik7XG59O1xuXG4vKipcbiAqIFJlLWV4cG9ydCB3YWl0Rm9yIHdpdGggcGF0Y2hlZCB3YWl0Rm9yXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHdhaXRGb3I8VD4oY2FsbGJhY2s6ICgpID0+IFQgZXh0ZW5kcyBQcm9taXNlPGFueT4gPyBuZXZlciA6IFQsIG9wdGlvbnM/OiBkdGxXYWl0Rm9yT3B0aW9ucyk6IFByb21pc2U8VD4ge1xuICByZXR1cm4gd2FpdEZvcldyYXBwZXIoZGV0ZWN0Q2hhbmdlc0Zvck1vdW50ZWRGaXh0dXJlcywgY2FsbGJhY2ssIG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIFJlLWV4cG9ydCB3YWl0Rm9yRWxlbWVudFRvQmVSZW1vdmVkIHdpdGggcGF0Y2hlZCB3YWl0Rm9yRWxlbWVudFRvQmVSZW1vdmVkXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHdhaXRGb3JFbGVtZW50VG9CZVJlbW92ZWQ8VD4oY2FsbGJhY2s6ICgoKSA9PiBUKSB8IFQsIG9wdGlvbnM/OiBkdGxXYWl0Rm9yT3B0aW9ucyk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gd2FpdEZvckVsZW1lbnRUb0JlUmVtb3ZlZFdyYXBwZXIoZGV0ZWN0Q2hhbmdlc0Zvck1vdW50ZWRGaXh0dXJlcywgY2FsbGJhY2ssIG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIE1hbnVhbGx5IGV4cG9ydCBvdGhlcndpc2Ugd2UgZ2V0IHRoZSBmb2xsb3dpbmcgZXJyb3Igd2hpbGUgcnVubmluZyBKZXN0IHRlc3RzXG4gKiBUeXBlRXJyb3I6IENhbm5vdCBzZXQgcHJvcGVydHkgZmlyZUV2ZW50IG9mIFtvYmplY3QgT2JqZWN0XSB3aGljaCBoYXMgb25seSBhIGdldHRlclxuICogZXhwb3J0cy5maXJlRXZlbnQgPSBmaXJlRXZlbnRcbiAqL1xuZXhwb3J0IHtcbiAgZmlyZUV2ZW50LFxuICBidWlsZFF1ZXJpZXMsXG4gIGdldEJ5TGFiZWxUZXh0LFxuICBnZXRBbGxCeUxhYmVsVGV4dCxcbiAgcXVlcnlCeUxhYmVsVGV4dCxcbiAgcXVlcnlBbGxCeUxhYmVsVGV4dCxcbiAgZmluZEJ5TGFiZWxUZXh0LFxuICBmaW5kQWxsQnlMYWJlbFRleHQsXG4gIGdldEJ5UGxhY2Vob2xkZXJUZXh0LFxuICBnZXRBbGxCeVBsYWNlaG9sZGVyVGV4dCxcbiAgcXVlcnlCeVBsYWNlaG9sZGVyVGV4dCxcbiAgcXVlcnlBbGxCeVBsYWNlaG9sZGVyVGV4dCxcbiAgZmluZEJ5UGxhY2Vob2xkZXJUZXh0LFxuICBmaW5kQWxsQnlQbGFjZWhvbGRlclRleHQsXG4gIGdldEJ5VGV4dCxcbiAgZ2V0QWxsQnlUZXh0LFxuICBxdWVyeUJ5VGV4dCxcbiAgcXVlcnlBbGxCeVRleHQsXG4gIGZpbmRCeVRleHQsXG4gIGZpbmRBbGxCeVRleHQsXG4gIGdldEJ5QWx0VGV4dCxcbiAgZ2V0QWxsQnlBbHRUZXh0LFxuICBxdWVyeUJ5QWx0VGV4dCxcbiAgcXVlcnlBbGxCeUFsdFRleHQsXG4gIGZpbmRCeUFsdFRleHQsXG4gIGZpbmRBbGxCeUFsdFRleHQsXG4gIGdldEJ5VGl0bGUsXG4gIGdldEFsbEJ5VGl0bGUsXG4gIHF1ZXJ5QnlUaXRsZSxcbiAgcXVlcnlBbGxCeVRpdGxlLFxuICBmaW5kQnlUaXRsZSxcbiAgZmluZEFsbEJ5VGl0bGUsXG4gIGdldEJ5RGlzcGxheVZhbHVlLFxuICBnZXRBbGxCeURpc3BsYXlWYWx1ZSxcbiAgcXVlcnlCeURpc3BsYXlWYWx1ZSxcbiAgcXVlcnlBbGxCeURpc3BsYXlWYWx1ZSxcbiAgZmluZEJ5RGlzcGxheVZhbHVlLFxuICBmaW5kQWxsQnlEaXNwbGF5VmFsdWUsXG4gIGdldEJ5Um9sZSxcbiAgZ2V0QWxsQnlSb2xlLFxuICBxdWVyeUJ5Um9sZSxcbiAgcXVlcnlBbGxCeVJvbGUsXG4gIGZpbmRCeVJvbGUsXG4gIGZpbmRBbGxCeVJvbGUsXG4gIGdldEJ5VGVzdElkLFxuICBnZXRBbGxCeVRlc3RJZCxcbiAgcXVlcnlCeVRlc3RJZCxcbiAgcXVlcnlBbGxCeVRlc3RJZCxcbiAgZmluZEJ5VGVzdElkLFxuICBmaW5kQWxsQnlUZXN0SWQsXG4gIGNyZWF0ZUV2ZW50LFxuICBnZXREZWZhdWx0Tm9ybWFsaXplcixcbiAgZ2V0RWxlbWVudEVycm9yLFxuICBnZXROb2RlVGV4dCxcbiAgZ2V0UXVlcmllc0ZvckVsZW1lbnQsXG4gIGdldFJvbGVzLFxuICBpc0luYWNjZXNzaWJsZSxcbiAgbG9nRE9NLFxuICBsb2dSb2xlcyxcbiAgcHJldHR5RE9NLFxuICBxdWVyaWVzLFxuICBxdWVyeUFsbEJ5QXR0cmlidXRlLFxuICBxdWVyeUJ5QXR0cmlidXRlLFxuICBxdWVyeUhlbHBlcnMsXG59IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvZG9tJztcblxuLy8gZXhwb3J0IHBhdGNoZWQgZHRsXG5leHBvcnQgeyBzY3JlZW4sIHdhaXRGb3IsIHdhaXRGb3JFbGVtZW50VG9CZVJlbW92ZWQsIHdpdGhpbiB9O1xuIl19